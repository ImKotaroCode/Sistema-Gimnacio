<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartFit - Contacto</title>
  <link rel="stylesheet" href="/css/estilos.css" />
</head>
<body>
  <nav>
    <ul>
      <li class="logo">SMARTFIT</li>
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
      <div class="nav-links" id="navLinks">
        <li><a href="index.html">Inicio</a></li>
        <li><a href="precios.html">Precios</a></li>
        <li><a href="ubicaciones.html">Ubicaciones</a></li>
        <li><a href="clases.html">Clases</a></li>
        <li><a href="contacto.html">Contacto</a></li>
        <li id="perfilLink" style="display:none;"><a href="miperfil.html">Mi Perfil</a></li>
        <li id="adminLink" style="display:none;"><a href="admin.html">Panel Admin</a></li>
        <li class="user-info" id="userInfo">
          <span class="user-name" id="userName"></span>
          <button class="btn-logout" onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
        </li>
        <li id="authLink"><a href="login.html">Login</a></li>
      </div>
    </ul>
  </nav>
  <div class="page active" id="contact">
    <div class="contact-container">
      <h2 style="text-align:center; color:#ff4500; margin-bottom:2rem;">Contacto</h2>
      <div class="contact-grid">
        <div>
          <div class="contact-info">
            <h3>Informaci√≥n de Contacto</h3>
            <p><strong>üìû Tel√©fono:</strong> +51 999 000 111</p>
            <p><strong>‚úâÔ∏è Email:</strong> hola@smartfit.com</p>
            <p><strong>‚è∞ Atenci√≥n:</strong> 24/7 v√≠a chat y email</p>
          </div>
        </div>
        <div>
          <div class="auth-form">
            <h3 style="text-align:center; color:#ff4500;">Env√≠anos un Mensaje</h3>
            <div id="contactSuccessMsg" class="success-message"></div>
            <div id="contactErrorMsg" class="error-message"></div>
            <form onsubmit="enviarMensajeContacto(event)">
              <div class="form-group"><label>Nombre</label><input type="text" id="contactNombre" required /></div>
              <div class="form-group"><label>Email</label><input type="email" id="contactEmail" required /></div>
              <div class="form-group"><label>Asunto</label><input type="text" id="contactAsunto" required /></div>
              <div class="form-group"><label>Mensaje</label><textarea id="contactMensaje" required style="min-height:120px;"></textarea></div>
              <button type="submit" class="btn" id="btnContact" style="width:100%;">Enviar Mensaje</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const API_BASE =
  location.hostname === "localhost"
    ? "http://localhost:8080"
    : "https://gimnacioapi.onrender.com";

const API_URL = `${API_BASE}/api`;

const ENDPOINTS = {
  contacto: {
    enviar: `${API_URL}/contacto`
  }
};
function toggleMobileMenu(){ document.getElementById('navLinks').classList.toggle('active'); }

function verificarSesion(){
  const u = localStorage.getItem('usuario');
  const t = localStorage.getItem('token');
  window.usuarioActual = (u && t) ? JSON.parse(u) : null;
}

function actualizarUIUsuario() {
  const isLogged = !!window.usuarioActual;
  const isAdmin = window.usuarioActual?.rol === 'ADMINISTRADOR' || window.usuarioActual?.rol === 'ENTRENADOR';

  document.getElementById('authLink').style.display = isLogged ? 'none' : 'block';
  document.getElementById('userInfo').classList.toggle('active', isLogged);
  document.getElementById('userName').textContent = isLogged ? (window.usuarioActual.nombreCompleto || '') : '';
  document.getElementById('perfilLink').style.display = isLogged ? 'block' : 'none';
  document.getElementById('adminLink').style.display = isAdmin ? 'block' : 'none';
}

function mostrarMensajeEnPagina(id,msg,tipo){
  const el=document.getElementById(id); el.textContent=msg; el.classList.add('show'); setTimeout(()=>el.classList.remove('show'), tipo==='success'?2500:4000);
}

async function enviarMensajeContacto(event){
  event.preventDefault();
  const btn=document.getElementById('btnContact'); btn.disabled=true; btn.textContent='Enviando...';
  try{
    const payload={ nombreRemitente:contactNombre.value, correoRemitente:contactEmail.value, asunto:contactAsunto.value, mensaje:contactMensaje.value };
    const res = await fetch(ENDPOINTS.contacto.enviar, {
      method:'POST',
      headers:{ 'Content-Type':'application/json', 'Accept':'application/json' },
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(()=>null);
    if (res.ok){ mostrarMensajeEnPagina('contactSuccessMsg', typeof data==='string'?data:'Mensaje enviado','success'); document.querySelector('#contact form').reset(); }
    else { mostrarMensajeEnPagina('contactErrorMsg', data?.mensaje||data?.error||'Error','error'); }
  }catch{ mostrarMensajeEnPagina('contactErrorMsg','Error de conexi√≥n','error'); }
  finally{ btn.disabled=false; btn.textContent='Enviar Mensaje'; }
}

function cerrarSesion() {
  localStorage.removeItem('token');
  localStorage.removeItem('usuario');
  window.usuarioActual = null;
  actualizarUIUsuario();
  alert('Sesi√≥n cerrada');
}

window.addEventListener('DOMContentLoaded', () => {
  verificarSesion();
  actualizarUIUsuario();
});
</script>
</body>
</html>
